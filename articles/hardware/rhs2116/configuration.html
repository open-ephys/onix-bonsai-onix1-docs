<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>Headstage Rhs2116 Configuration </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="Headstage Rhs2116 Configuration ">
      
      
      <link rel="icon" href="../../../favicon.png">
      <link rel="stylesheet" href="../../../public/docfx.min.css">
      <link rel="stylesheet" href="../../../public/main.css">
      <meta name="docfx:navrel" content="../../../toc.html">
      <meta name="docfx:tocrel" content="../../toc.html">
      
      <meta name="docfx:rel" content="../../../">
      
      
      <meta name="docfx:docurl" content="https://github.com/open-ephys/bonsai-onix1-docs/blob/main/articles/hardware/rhs2116/configuration.md/#L1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./../../../public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../../../index.html">
            <img id="logo" class="svg" src="../../../logo-light-mode.svg" alt="">
            
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled="" placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="rhs2116_configuration">
          <h1>Headstage Rhs2116 Configuration</h1>

  <p>
    The following excerpt from the Headstage Rhs2116 <a class="xref" href="overview.html">
    example workflow</a> demonstrates how to configure your Headstage Rhs2116 and Breakout Board 
    in Bonsai. This process comprises of the following steps: 
    <ul>
      <li> 
        Create an ONIX acquisition context using <sa class="xref" href="../../../api/OpenEphys.Onix1.CreateContext.html">CreateContext
      </sa></li>
      <li> 
        Configure the Headstage Rhs2116 and the Breakout Board using <a class="xref" href="../../../api/OpenEphys.Onix1.ConfigureHeadstageRhs2116.html">ConfigureHeadstageRhs2116</a> and 
        <a class="xref" href="../../../api/OpenEphys.Onix1.ConfigureBreakoutBoard.html">
        ConfigureBreakoutBoard</a>
      </li>
      <li> 
        Start acquisition using <a class="xref" href="../../../api/OpenEphys.Onix1.StartAcquisition.html">StartAcquisition</a>.
      </li>
  </ul>
  
  

  <div class="workflow"> 
    <p><img src="../../../workflows/hardware/rhs2116/configuration.bonsai" alt="~/workflows/hardware/rhs2116/configuration.bonsai workflow"></p>
  </div>

  <div class="NOTE alert alert-info">
      <h5>NOTE</h5>
      <p>
          To learn more about the top-level configuration motif in every workflow involving ONIX
          hardware, visit the <a class="xref" href="../../getting-started/initialize-oni-context.html">Configuration Chain
          Tutorial</a>.
      </p>
  </div>

  <h2>Creating an Acquisition Context</h2>

  <p>
    The <code>CreateContext</code> operator creates a <a class="xref" href="../../../api/OpenEphys.Onix1.ContextTask.html">ContextTask</a> that defines the device driver and
    index where the hardware exists. The Driver property is set to "riffa" which is the name of the
    PCIe device used by ONIX. In this case, the Index property is set to 0 because there is only a
    single ONIX system. If a second system is used on the same computer, a second
    <code>CreateContext</code> operator would be required in its own configuration chain, with its
    Index property set to 1.
  </p>

  <h2 id="configuring-the-breakout-board-and-headstage-rhs2116">Configuring the Breakout Board and Headstage Rhs2116</h2>
<p>The <code>ConfigureBreakoutBoard</code> operator configures the Onix Breakout Board. In the Headstage Rhs2116
example tutorial, it is configured to enable digital inputs to serve as a trigger for the Headstage
Rhs2116's electrical and optical stimulation and to enable monitoring of the percentage of memory
occupied. This is accomplished by leaving all of the <code>ConfigureBreakoutBoard</code> properties set to
their default values except its Memory Monitor Enable property is set to &quot;True&quot;.</p>
<p>The <code>ConfigureHeadstageRhs2116</code> operator is used to configure the Headstage Rhs2116. In the
Headstage Rhs2116 example tutorial, it is configured to enable streaming of electrophysiology data
from a Rhs2116 amplifier, orientation data from the on-board Bno055 IMU, and position data from the
Ts4231. This is accomplished in the Headstage Rhs2116 example workflow by leaving all of the
<code>ConfigureHeadstageRhs2116</code> properties set to their default values.</p>
<p>When the workflow is started, the current time (based on
<a href="https://en.wikipedia.org/wiki/Coordinated_Universal_Time">Coordinated Universal Time</a>) is saved, along with global
hardware parameters governing data acquisition. This is accomplished using a
<a href="https://bonsai-rx.org/docs/api/Bonsai.Reactive.Timestamp.html">TimeStamp</a> operator to capture the computer's wall clock
time. The timestamp is saved along with <code>ContextTask</code>'s properties (e.g. AcquisitionClockHz, BlockReadSize,
BlockWriteSize) to a csv file (<code>start-time_&lt;filecount&gt;.csv</code>) when the workflow is started.</p>

<div class="TIP">
<h5>Tip</h5>
<p>For additional details on how to configure the headstage, as well as how to
set stimulus waveforms, check out the <a class="xref" href="gui.html">Rhs2116 GUI</a> page.</p>
</div>


  <h2>Starting Acquisition</h2>

  <p>
    After starting a workflow, the <a class="xref" href="../../../api/OpenEphys.Onix1.StartAcquisition.html">StartAcquisition</a>
    operator begins data acquisition with the hardware that has been configured. In the Headstage Rhs2116
    example workflow, most collected data is from the Headstage Rhs2116. The rate of data being
    produced by the hardware will be ~2.1 MB/s. The ReadSize property is set to
  4096 bytes, meaning data collection will wait until 4096 bytes of
    data have been produced by the hardware. At 2.1 MB/s the hardware will produce
  4096 bytes every ~1 ms. This is a hard bound on the latency of
    the system. If lower latencies were required, the hardware would need to produce data more quickly
    or the ReadSize property value would need to be reduced. 
  </p>

  <p>
    The WriteSize property is set to 2048 bytes. This determines the amount of memory that is
    preallocated for temporarily holding data before it is sent to hardware. It is less critical to
    performance unless the rate that data be written to the hardware is comparable to the rate that
    the hardware produces data, which is not a common scenario.
  </p>

  <div class="NOTE alert alert-info">
    <h5>NOTE</h5>
    <p>
      For an overview of the devices on the Headstage Rhs2116 that can be configured through the <a class="xref" href="../../../api/OpenEphys.Onix1.ConfigureHeadstageRhs2116.html">ConfigureHeadstageRhs2116</a> operator, visit
      the <a class="xref" href="overview.html">Headstage Rhs2116 Overview</a>.
    </p>
  </div>




</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/open-ephys/bonsai-onix1-docs/blob/main/articles/hardware/rhs2116/configuration.md/#L1" class="edit-link">Edit this page</a>
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          &copy; 2024 Open Ephys and Contributors. Made with <a href="https://dotnet.github.io/docfx">docfx</a>
        </div>
      </div>
    </footer>
  </body>
</html>
